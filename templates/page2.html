<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì˜¤ëŠ˜ì˜ ìš´ì„¸ ëŒ€ì‹œë³´ë“œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Serif KR', serif;
      background: #fdf7ff;
      margin: 0;
      padding: 16px;
      font-size: 17px;
    }

    .container {
      width: 100%;
      background: white;
      padding: 24px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h2 {
      font-size: 24px;
      text-align: center;
      color: #6a1b9a;
      margin-bottom: 16px;
    }

    h3 {
      font-size: 20px;
      color: #6a1b9a;
      margin-top: 24px;
    }

    p, label {
      font-size: 17px;
      line-height: 1.6;
      color: #444;
    }

    .section {
      margin-top: 24px;
    }

    input, select {
      width: 100%;
      font-size: 18px;
      padding: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-top: 6px;
    }

    button {
      width: 100%;
      padding: 16px;
      margin-top: 24px;
      background-color: #6a1b9a;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #4a148c;
    }

    .menu-list a {
      display: block;
      background: #6a1b9a;
      color: white;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      text-align: center;
    }

    .menu-list a:hover {
      background: #4a148c;
    }

    .tip, .section > div, .spinner {
      font-size: 16px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 5px solid #e0b3ff;
      border-top: 5px solid #6a1b9a;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes popFade {
      0%   { transform: translateX(-50%) scale(0.8); opacity: 0; }
      20%  { transform: translateX(-50%) scale(1.1); opacity: 1; }
      60%  { transform: translateX(-50%) scale(1); }
      100% { transform: translateX(-50%) scale(1); opacity: 0; }
    }
  </style>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3K010VY3ZG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3K010VY3ZG');
</script>
</head>
<body>
  <div id="loadingInitial" style="text-align:center; padding: 60px;">
    <div class="spinner"></div>
    <p style="margin-top: 14px; font-size: 18px; color: #6a1b9a;">ì‚¬ì£¼ë¥¼ ì •ì„±ê» ì •ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
  </div>
  <div id="welcomeBanner" style="
    display:none;
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffeb3b;
    padding: 20px 30px;
    border-radius: 16px;
    font-weight: bold;
    font-size: 18px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    z-index: 9999;
    animation: popFade 4s ease forwards;
  ">
âœ¨ {{ name }}ë‹˜ì˜ ì‚¬ì£¼í’€ì´ê°€ ì™„ì„±!!  ğŸ’«
</div>
  <div id="realContent" style="display:none;">
  <div class="container">
    <h2>ğŸ”® {{ name }}ë‹˜ì˜ ì‚¬ì£¼íŒ”ì</h2>

    <div class="section">
      <h3>ğŸ§  ë¶„ì„ ê²°ê³¼</h3>
      <p>{{ saju_analyzer_result|safe }}</p>

      <h3>ğŸŒ¿ ì‚¬ì£¼ ìƒì„¸ ì •ë³´</h3>
      <table style="width:100%; border-collapse: collapse; margin-top: 12px; font-size: 16px;">
        <thead>
          <tr style="background-color: #f3e5f5; color: #4a148c;">
            <th style="padding: 10px; border: 1px solid #ccc;">í•­ëª©</th>
            <th style="padding: 10px; border: 1px solid #ccc;">ë…„æŸ±</th>
            <th style="padding: 10px; border: 1px solid #ccc;">ì›”æŸ±</th>
            <th style="padding: 10px; border: 1px solid #ccc;">ì¼æŸ±</th>
            <th style="padding: 10px; border: 1px solid #ccc;">ì‹œæŸ±</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ì²œê°„</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.gan }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.gan }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.gan }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.gan }}</td>
          </tr>
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ì§€ì§€</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.zhi }}</td>
          </tr>
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ì˜¤í–‰</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.element_gan }}/{{ saju_info.year.element_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.element_gan }}/{{ saju_info.month.element_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.element_gan }}/{{ saju_info.day.element_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.element_gan }}/{{ saju_info.hour.element_zhi }}</td>
          </tr>
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ìŒì–‘</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.yin_gan }}/{{ saju_info.year.yin_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.yin_gan }}/{{ saju_info.month.yin_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.yin_gan }}/{{ saju_info.day.yin_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.yin_gan }}/{{ saju_info.hour.yin_zhi }}</td>
          </tr>
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ì‹­ì„±</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.ten_god }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.ten_god }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.ten_god }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.ten_god }}</td>
          </tr>
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ì§€ì§€ì˜ ì‹­ì„±</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.ten_god_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.ten_god_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.ten_god_zhi }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.ten_god_zhi }}</td>
          </tr>
          <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ì‹­ì´ìš´ì„±</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.twelve_stage }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.twelve_stage }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.twelve_stage }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.twelve_stage }}</td>
          </tr>
          <!-- <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">ì‹­ì´ì‹ ì‚´</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.year.twelve_god }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.month.twelve_god }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.day.twelve_god }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ saju_info.hour.twelve_god }}</td>
          </tr> -->
        </tbody>
      </table>
      {% if ctext_explanation %}
      <div style="margin-top: 20px; background: #f3f3ff; border-left: 5px solid #11a09b; padding: 15px; border-radius: 8px;">
        <strong>ğŸ“œ ì‚¼ëª…í†µíšŒ ì›ë¬¸</strong><br><br>
          <div style="white-space: pre-wrap;">{{ ctext_explanation|safe }}</div>
        </div>
      {% endif %}

      {% if ctext_kr_literal %}
        <div style="margin-top: 20px; background: #fff8e1; border-left: 5px solid #ff6f00; padding: 15px; border-radius: 8px;">
          <strong>ğŸ“š ì‚¼ëª…í†µíšŒ í•´ì„</strong><br><br>
          <div style="white-space: pre-wrap;">{{ ctext_kr_literal|safe }}</div>
        </div>
      {% endif %}

      
      
      {% if ilju_interpretation and ilju_interpretation.kr %}
        <div style="margin-top: 20px; background: #f3f3ff; border-left: 5px solid #7986cb; padding: 15px; border-radius: 8px;">
          <strong>ğŸ“œ ì¼ì£¼ í•´ì„ ({{ ilju | safe }}):</strong><br><br>
          {{ ilju_interpretation.kr | safe }}
        </div>
      {% endif %}


      <h3>âœ¨ AI ì‚¬ì£¼ í•´ì„</h3>
      <button onclick="loadSajuAnalysis()">AI ì‚¬ì£¼ í•´ì„ ë³´ê¸°</button>
      <div id="aiAnalysisBox" style="display:none; margin-top:20px; background:#f3f3ff; padding:15px; border-left:5px solid #6a1b9a; border-radius:8px;"></div>

    </div>

    <div class="section">
      <div style="margin-bottom: 20px; background: #fff3e0; border-left: 5px solid #ffb74d; padding: 15px; border-radius: 8px; color: #444;">
        â˜• ë§ˆìŒì— ë“œì…¨ë‹¤ë©´, ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ìœ¼ë¡œ ì‘ì›í•´ ì£¼ì„¸ìš”! 
        <a href="{{ coffee_link }}" target="_blank" style="color: #d84315; font-weight: bold; text-decoration: none; margin-left: 8px;">
          ì»¤í”¼ ì‚¬ì£¼ê¸° â†’
        </a>
      </div>
      <!-- <h3>ğŸ” ë” ì•Œê³  ì‹¶ë‹¤ë©´?</h3>
      <div class="menu-list">
        <a href="#" onclick="loadFortune('today')">ğŸŒŸ ì˜¤ëŠ˜ì˜ ìš´ì„¸</a>
        <a href="#" onclick="loadFortune('money')">ë‚´ ì§€ê°‘ì— í–‰ìš´ì´ ë“¤ì–´ì˜¬ê¹Œ?</a>
        <a href="#" onclick="loadFortune('health')">ì´ë²ˆ ì£¼ ê±´ê°•, ë¬¸ì œ ì—†ì„ê¹Œ?</a>
        <a href="#" onclick="openMatchModal()">ì§ê¶ê³¼ ë‚˜ì˜ ê¶í•© ì ìˆ˜ëŠ”?</a>
        <a href="#" onclick="loadFortune('mission')">ì˜¤ëŠ˜ ë‚˜ì˜ íŠ¹ë³„í•œ ë¯¸ì…˜ì€?</a>
      </div> 
      -->
      <div id="loadingSpinner" style="display:none; margin-top: 30px; text-align: center;">
        <div class="spinner"></div>
        <p style="margin-top: 10px; color: #6a1b9a;">ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
      </div>
    </div>

    <div id="fortuneModal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 999; overflow-y: auto;">
      <div style="background: white; max-width: 700px; margin: 100px auto; padding: 40px; border-radius: 16px; position: relative; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); max-height: 90vh; overflow-y: auto;">
        <button onclick="closeModal()" style="position: absolute; top: 10px; right: 10px; background: #e0e0e0; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 18px; font-weight: bold; color: #555; cursor: pointer;">Ã—</button>
        <h3 id="modalTitle" style="color: #6a1b9a; font-size: 22px; text-align: center; margin-bottom: 20px;"></h3>
        <div id="modalContent" style="margin-top: 20px; line-height: 1.8; color: #333; font-size: 15px; text-align: left;"></div>
      </div>
    </div>

    <div id="matchModal" style="display:none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 999; overflow-y: auto;">
      <div style="background: white; max-width: 600px; margin: 80px auto; padding: 40px; border-radius: 16px; position: relative; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); max-height: 90vh; overflow-y: auto;">
        <button onclick="closeMatchModal()" style="position: absolute; top: 10px; right: 10px; background: #e0e0e0; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 18px; font-weight: bold; color: #555; cursor: pointer;">Ã—</button>
        <h3 style="color: #d81b60; text-align: center;">ğŸ’˜ ê¶í•© ì ìˆ˜ ë³´ê¸°</h3>

        <label>ë‚´ ì´ë¦„</label>
        <input type="text" id="yourName" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:6px;">

        <label>ë‚´ ìƒë…„ì›”ì¼</label>
        <input type="date" id="yourBirth" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:6px;">

        <label>ì§ê¶ ì´ë¦„</label>
        <input type="text" id="partnerName" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:6px;">

        <label>ì§ê¶ ìƒë…„ì›”ì¼</label>
        <input type="date" id="partnerBirth" style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ccc; border-radius:6px;">

        <button onclick="alert('ê²°ì œ ê¸°ëŠ¥ì€ ì•„ì§ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')" style="background:#6a1b9a; color:white; padding:12px 24px; border:none; border-radius:8px; font-weight:bold; width:100%;">â‚©1,000 ê²°ì œí•˜ê³  ê¶í•©ë³´ê¸°</button>
        <div style="text-align: center; margin-top: 20px;">
          <p style="font-size: 14px; color: #666;">
            ìš´ì„¸ê°€ ë§ˆìŒì— ë“œì…¨ë‹¤ë©´â€¦
              <a href="{{ coffee_link }}" target="_blank" style="color: #d81b60; font-weight: bold; text-decoration: none;">
                â˜• ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ìœ¼ë¡œ ì‘ì›í•´ ì£¼ì„¸ìš”
              </a>
          </p>
        </div>
      </div>
    </div>

    <!-- <div class="tip">
      ğŸ’– ì§€ê¸ˆì€ ì¼ë¶€ ìš´ì„¸ ë©”ë‰´ê°€ ë¬´ë£Œë¡œ ì—´ë ¤ ìˆì–´ìš”!  <br>
      ë”°ëœ»í•œ ë§ˆìŒìœ¼ë¡œ í•¨ê»˜í•´ì£¼ì‹œëŠ” ë¶„ë“¤ ë•ë¶„ì— ê°€ëŠ¥í•œ ì¼ì´ì—ìš” ğŸ˜Š  <br>
    </div> -->
  </div>
  </div>
  <div id="loadingOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.7); z-index: 1000;">
    <div class="spinner" style="margin-top: 40vh;"></div>
  </div>
  <script>
    const cachedFortunes = {};  // ë©”ë‰´ë³„ ìºì‹œ ì €ì¥

    function showLoading() {
      document.getElementById('loadingOverlay').style.display = 'block';
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').style.display = 'none';
    }

    function loadFortune(menu) {
      if (cachedFortunes[menu] && cachedFortunes[menu].fortune_result) {
        showFortuneModal(cachedFortunes[menu]);
        return;
      }

      showLoading();

      fetch('/api/fortune/' + menu)
        .then(res => res.json())
        .then(data => {
          cachedFortunes[menu] = data;
          showFortuneModal(data);
          hideLoading();
        })
        .catch(err => {
          alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + err);
          hideLoading();
        });
    }

    function showFortuneModal(data) {
    console.log("ğŸ’¬ ëª¨ë‹¬ì— ì „ë‹¬ëœ ë°ì´í„°", data);
    
    if (!data || !data.fortune_result) {
      alert("ìš´ì„¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
      return;
    }

    const title = data.menu_title || 'ìš´ì„¸ ê²°ê³¼';
    const content = data.fortune_result || 'ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';

    document.getElementById('modalTitle').innerText = title;
    let coffeeMsg = `
      <div style="text-align: center; margin-top: 40px;">
        <p style="font-size: 15px; color: #555;">
          ì´ ìš´ì„¸ê°€ ë„ì›€ì´ ë˜ì…¨ë‚˜ìš”? <br>
          ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ìœ¼ë¡œ ì´ ì„œë¹„ìŠ¤ë¥¼ ì‘ì›í•´ ì£¼ì„¸ìš” â˜•  
          <br><a href="{{ coffee_link }}" target="_blank" 
             style="color: #d81b60; font-weight: bold; text-decoration: none;">
            ğŸ‘‰ ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ìœ¼ë¡œ ì‘ì›í•˜ê¸°
          </a>
        </p>
      </div>`;
    document.getElementById('modalContent').innerHTML = content + coffeeMsg;
      document.getElementById('fortuneModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('fortuneModal').style.display = 'none';
    }

    function openMatchModal() {
      document.getElementById('matchModal').style.display = 'block';
    }

    function closeMatchModal() {
      document.getElementById('matchModal').style.display = 'none';
    }
  </script>
  <script>
    function loadSajuAnalysis() {
      const box = document.getElementById("aiAnalysisBox");
      box.innerHTML = '<div class="spinner" style="margin:20px auto;"></div><p style="text-align:center; color:#6a1b9a;">AI í•´ì„ ì¤‘ì…ë‹ˆë‹¤...</p>';
      box.style.display = 'block';

      fetch('/api/saju_ai_analysis', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(res => res.json())
        .then(data => {
          if (data.result) {
            box.innerHTML = '<strong>ğŸ” AI í•´ì„ ê²°ê³¼:</strong><br><br>' + data.result;
          } else {
            box.innerHTML = '<p style="color:red;">AI í•´ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
          }
        })
        .catch(err => {
          box.innerHTML = '<p style="color:red;">ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
        });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    window.onload = function () {
      setTimeout(() => {
        document.getElementById('loadingInitial').style.display = 'none';
        document.getElementById('realContent').style.display = 'block';

        // 2.2ì´ˆ í›„ì— íŒ¡ í„°ì§€ëŠ” íš¨ê³¼
        confetti({
          particleCount: 120,
          spread: 90,
          origin: { y: 0.6 },
        });

        // welcomeBannerë„ ë™ì‹œì— í‘œì‹œ
        const banner = document.getElementById('welcomeBanner');
        banner.style.display = 'block';
        setTimeout(() => {
          banner.style.display = 'none';
        }, 4000);
      }, 3000);
    };
  </script>
</body>
</html>